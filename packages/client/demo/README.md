# Minimal demo for the web

Two browser clients communicating with each other via a Node.js backend.

## Preconditions

The source files are directly served as they are (no transpiling etc.). For this reason, the browser must support ES8 Javascript and Import Maps. At the time of writing, only Chrome version greater than version 74 has experimental support for Import Maps. Until Import Maps are enabled by default everywhere, enable "Experimental Web Platform features" under `chrome://flags`.

Install dependencies:

```sh
npm i -g jspm@2.0.0-beta.7 http-server

cd packages/server
npm ci

cd packages/client
jspm install @jspm/core socket.io-client uuid-random
```

## Run the demo

Run the backend:

```sh
cd packages/server
node -r esm demo/index.js
```

Serve the client files for the browser:

```sh
cd packages/client
http-server
```

`http-server` will output a URL e.g. `http://127.0.0.1:8080/`. Using that URL, open two browser tabs
with the following two URLs:

`http://127.0.0.1/demo/bob.html`  
`http://127.0.0.1/demo/alice.html`


### Things to try

Open Chromes DevTools in both browser tabs and inspect the console messages.

You can modify the source directly and just reload the browser tab for immediate effect (no
transpiling or building steps).

In the demo, alice sends a message to Bob, and Bob will output: `Peer says: "Hello Bob! I am Alice!"`.

Then try the following:

1. On Alice's browser, access the peer's socket using `bob`. Add a custom event handler, e.g. `bob.on('blah', () => console.log('Bob says blah!'));`
2. On Bob's browser, call `peer0.emit('blah');`. This will trigger the console output on Alice's side. Notice how you did *neiter* have to implement anything on the backend, *nor* restart anything.
3. Close Alice's browser (the DevTools window *and* the browser tab). On Bob's side this will print:
   "Peer disconnected"

## Development

The file `importmap.json` was generated by running:

```sh
jspm map ./demo/bob.js -o demo/importmap.json --map-base .
```

